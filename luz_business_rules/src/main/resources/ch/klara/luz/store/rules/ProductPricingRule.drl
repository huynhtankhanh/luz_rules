package ch.klara.luz.store.rules;

import ch.klara.luz.store.model.ProductPricing;
import ch.klara.luz.store.model.CustomerPricingModel;
import ch.klara.luz.store.model.SubscriptionPricingModel;
import java.lang.Number;

dialect "mvel"
dialect "java"

rule "Price plan is SINGLE"
	when
		$productPricing : ProductPricing( pricePlan == "SINGLE" )
	then
		$productPricing.setPrice(3.0B);
end

rule "Price plan is VOLUME"
    when
        $productPricing: ProductPricing(pricePlan == "VOLUME", $volume : volume )
    then
        $productPricing.setPrice(2.0B * $volume);
end

rule "Product code is POS"
    when
        $productPricing: ProductPricing(productCode contains "POS" && pricePlan == "MONTHLY")
    then
        $productPricing.setPrice(49.0B);
end

rule "Product code is BOOKING"
    when
        $productPricing: ProductPricing(productCode contains "BOOKING" && pricePlan == "MONTHLY")
    then
        $productPricing.setPrice(79.0B);
end

rule "Price plan is MONTHLY"
    when
        $productPricing: ProductPricing(productCode not contains "POS" && productCode not contains "BOOKING" && pricePlan == "MONTHLY")
    then
        $productPricing.setPrice(39.0B);
end

rule "Price plan is QUARTERLY"
    when
        $productPricing: ProductPricing(pricePlan == "QUARTERLY")
    then
        $productPricing.setPrice(100.0B);
end

rule "Price plan is YEARLY"
    when
        $productPricing: ProductPricing(pricePlan == "YEARLY")
    then
        $productPricing.setPrice(400.0B);
end

rule "Customer legal form is EU and price plan is yearly"
    when
        $customer: CustomerPricingModel(legalForm == "EU");
        $productPricing: ProductPricing(pricePlan == "YEARLY", companyUri == $customer.companyUri);
    then
        $productPricing.setPrice(359.15B);
        $productPricing.setTestingDuration("P30D");
end

rule "Being customer since first day of year 2018 and price plan is QUARTERLY"
    when
        $customer: CustomerPricingModel(customerSinceDate >= "1-Jan-2018")
        $productPricing: ProductPricing(pricePlan == "QUARTERLY", companyUri == $customer.companyUri)
    then
        $productPricing.setPrice(95.0B)
        $productPricing.setTestingDuration("P1M")
end

rule "There is a subscription for 'Send And Print' product, deduct for 'Valiant Banking' product"
    when
        $subscription: SubscriptionPricingModel(productCode == "Send And Print" )
        $productPricing: ProductPricing(productCode == "Valiant Banking", companyUri == $subscription.companyUri)
    then
        $productPricing.setPrice(55.0B)
end
